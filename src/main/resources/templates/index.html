<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${serverName} + ' - Estad√≠sticas'">Minecraft Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .minecraft-font { font-family: 'Courier New', monospace; }
        .card-hover:hover { transform: translateY(-2px); transition: transform 0.2s; }
        .gradient-bg { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
        .live-indicator { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .event-enter { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold minecraft-font mb-4">
                <i class="fas fa-cube text-green-500 mr-3"></i>
                <span th:text="${serverName}">Server Stats</span>
            </h1>
            <div class="flex justify-center items-center flex-wrap gap-4 text-gray-400">
                <span id="connection-status" class="flex items-center">
                    <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                    Conectando...
                </span>
                <span>‚Ä¢</span>
                <span class="flex items-center">
                    <i class="fas fa-calendar mr-2"></i>
                    <span id="server-date">-</span>
                </span>
                <span>‚Ä¢</span>
                <span class="flex items-center text-xl font-mono text-green-400">
                    <i class="fas fa-clock mr-2"></i>
                    <span id="server-time" class="live-indicator">--:--:--</span>
                </span>
                <span>‚Ä¢</span>
                <span class="text-xs">
                    Actualizado: <span id="last-update" th:text="${stats.lastUpdated}">-</span>
                </span>
            </div>
        </header>

        <!-- Live Status Bar -->
        <section class="mb-8">
            <div class="bg-gray-800/70 rounded-lg p-4 flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center space-x-4">
                    <div id="server-status" class="flex items-center">
                        <span class="w-3 h-3 bg-green-500 rounded-full mr-2 live-indicator"></span>
                        <span class="font-bold">Servidor Online</span>
                    </div>
                    <div class="text-gray-400">|</div>
                    <div id="online-players-count" class="flex items-center">
                        <i class="fas fa-users text-green-400 mr-2"></i>
                        <span id="player-count">0</span>/<span id="max-players">10</span> jugadores
                    </div>
                </div>
                <div id="online-players-list" class="flex flex-wrap gap-2">
                    <!-- Online players will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Server Totals -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-server text-blue-400 mr-3"></i>
                Totales del Servidor
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-users text-3xl text-green-400 mb-2"></i>
                    <p class="text-2xl font-bold" th:text="${stats.totalPlayers}">0</p>
                    <p class="text-gray-400 text-sm">Jugadores</p>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-cubes text-3xl text-yellow-400 mb-2"></i>
                    <p class="text-2xl font-bold" th:text="${#numbers.formatInteger(stats.serverTotals.totalBlocksMined, 1, 'COMMA')}">0</p>
                    <p class="text-gray-400 text-sm">Bloques Minados</p>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-hammer text-3xl text-orange-400 mb-2"></i>
                    <p class="text-2xl font-bold" th:text="${#numbers.formatInteger(stats.serverTotals.totalItemsCrafted, 1, 'COMMA')}">0</p>
                    <p class="text-gray-400 text-sm">Items Crafteados</p>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-skull text-3xl text-red-400 mb-2"></i>
                    <p class="text-2xl font-bold" th:text="${#numbers.formatInteger(stats.serverTotals.totalMobsKilled, 1, 'COMMA')}">0</p>
                    <p class="text-gray-400 text-sm">Mobs Eliminados</p>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-heart-crack text-3xl text-pink-400 mb-2"></i>
                    <p class="text-2xl font-bold" th:text="${stats.serverTotals.totalDeaths}">0</p>
                    <p class="text-gray-400 text-sm">Muertes Totales</p>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-hourglass-half text-3xl text-purple-400 mb-2"></i>
                    <p class="text-2xl font-bold" th:text="${stats.serverTotals.totalPlayTimeFormatted}">0h</p>
                    <p class="text-gray-400 text-sm">Tiempo Jugado</p>
                </div>
            </div>
        </section>

        <!-- Leaderboards -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-trophy text-yellow-400 mr-3"></i>
                Leaderboards
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Most Blocks Mined -->
                <div class="bg-gray-800/50 rounded-lg p-6 card-hover">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-pickaxe text-yellow-400 mr-2"></i>
                        M√°s Bloques Minados
                    </h3>
                    <ul class="space-y-2">
                        <li th:each="entry, stat : ${stats.leaderboards.mostBlocksMined}" 
                            class="flex justify-between items-center py-2 border-b border-gray-700 last:border-0">
                            <span class="flex items-center">
                                <span th:class="${entry.rank == 1 ? 'text-yellow-400' : (entry.rank == 2 ? 'text-gray-400' : (entry.rank == 3 ? 'text-orange-600' : 'text-gray-500'))}"
                                      class="w-6 font-bold" th:text="'#' + ${entry.rank}">#1</span>
                                <a th:href="@{/player/{uuid}(uuid=${entry.playerUuid})}" 
                                   class="ml-2 hover:text-green-400 transition-colors"
                                   th:text="${entry.playerName}">Player</a>
                            </span>
                            <span class="text-green-400 font-mono" th:text="${#numbers.formatInteger(entry.value, 1, 'COMMA')}">0</span>
                        </li>
                    </ul>
                </div>

                <!-- Most Mobs Killed -->
                <div class="bg-gray-800/50 rounded-lg p-6 card-hover">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-skull-crossbones text-red-400 mr-2"></i>
                        M√°s Mobs Eliminados
                    </h3>
                    <ul class="space-y-2">
                        <li th:each="entry : ${stats.leaderboards.mostMobsKilled}" 
                            class="flex justify-between items-center py-2 border-b border-gray-700 last:border-0">
                            <span class="flex items-center">
                                <span th:class="${entry.rank == 1 ? 'text-yellow-400' : (entry.rank == 2 ? 'text-gray-400' : (entry.rank == 3 ? 'text-orange-600' : 'text-gray-500'))}"
                                      class="w-6 font-bold" th:text="'#' + ${entry.rank}">#1</span>
                                <a th:href="@{/player/{uuid}(uuid=${entry.playerUuid})}" 
                                   class="ml-2 hover:text-green-400 transition-colors"
                                   th:text="${entry.playerName}">Player</a>
                            </span>
                            <span class="text-red-400 font-mono" th:text="${#numbers.formatInteger(entry.value, 1, 'COMMA')}">0</span>
                        </li>
                    </ul>
                </div>

                <!-- Most Play Time -->
                <div class="bg-gray-800/50 rounded-lg p-6 card-hover">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-clock text-purple-400 mr-2"></i>
                        M√°s Tiempo Jugado
                    </h3>
                    <ul class="space-y-2">
                        <li th:each="entry : ${stats.leaderboards.mostPlayTime}" 
                            class="flex justify-between items-center py-2 border-b border-gray-700 last:border-0">
                            <span class="flex items-center">
                                <span th:class="${entry.rank == 1 ? 'text-yellow-400' : (entry.rank == 2 ? 'text-gray-400' : (entry.rank == 3 ? 'text-orange-600' : 'text-gray-500'))}"
                                      class="w-6 font-bold" th:text="'#' + ${entry.rank}">#1</span>
                                <a th:href="@{/player/{uuid}(uuid=${entry.playerUuid})}" 
                                   class="ml-2 hover:text-green-400 transition-colors"
                                   th:text="${entry.playerName}">Player</a>
                            </span>
                            <span class="text-purple-400 font-mono" th:text="${entry.formattedValue}">0h</span>
                        </li>
                    </ul>
                </div>

                <!-- Most Deaths -->
                <div class="bg-gray-800/50 rounded-lg p-6 card-hover">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-heart-crack text-pink-400 mr-2"></i>
                        M√°s Muertes
                    </h3>
                    <ul class="space-y-2">
                        <li th:each="entry : ${stats.leaderboards.mostDeaths}" 
                            class="flex justify-between items-center py-2 border-b border-gray-700 last:border-0">
                            <span class="flex items-center">
                                <span th:class="${entry.rank == 1 ? 'text-yellow-400' : (entry.rank == 2 ? 'text-gray-400' : (entry.rank == 3 ? 'text-orange-600' : 'text-gray-500'))}"
                                      class="w-6 font-bold" th:text="'#' + ${entry.rank}">#1</span>
                                <a th:href="@{/player/{uuid}(uuid=${entry.playerUuid})}" 
                                   class="ml-2 hover:text-green-400 transition-colors"
                                   th:text="${entry.playerName}">Player</a>
                            </span>
                            <span class="text-pink-400 font-mono" th:text="${entry.value}">0</span>
                        </li>
                    </ul>
                </div>

                <!-- Most Distance Walked -->
                <div class="bg-gray-800/50 rounded-lg p-6 card-hover">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-person-walking text-blue-400 mr-2"></i>
                        M√°s Distancia Recorrida
                    </h3>
                    <ul class="space-y-2">
                        <li th:each="entry : ${stats.leaderboards.mostDistanceWalked}" 
                            class="flex justify-between items-center py-2 border-b border-gray-700 last:border-0">
                            <span class="flex items-center">
                                <span th:class="${entry.rank == 1 ? 'text-yellow-400' : (entry.rank == 2 ? 'text-gray-400' : (entry.rank == 3 ? 'text-orange-600' : 'text-gray-500'))}"
                                      class="w-6 font-bold" th:text="'#' + ${entry.rank}">#1</span>
                                <a th:href="@{/player/{uuid}(uuid=${entry.playerUuid})}" 
                                   class="ml-2 hover:text-green-400 transition-colors"
                                   th:text="${entry.playerName}">Player</a>
                            </span>
                            <span class="text-blue-400 font-mono" th:text="${entry.formattedValue}">0 km</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Detailed Server Stats -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-chart-bar text-purple-400 mr-3"></i>
                Estad√≠sticas Detalladas del Servidor
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <!-- Total Damage Dealt -->
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-sword text-red-400 text-2xl mb-2"></i>
                    <p class="text-2xl font-bold text-red-400" id="total-damage"
                       th:text="${#numbers.formatInteger(stats.serverTotals.totalDamageDealt, 1, 'COMMA')}">0</p>
                    <p class="text-xs text-gray-400">Da√±o Infligido</p>
                </div>
                <!-- Total Distance -->
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-route text-blue-400 text-2xl mb-2"></i>
                    <p class="text-2xl font-bold text-blue-400" id="total-distance"
                       th:text="${#numbers.formatDecimal(stats.serverTotals.totalDistanceTraveled / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</p>
                    <p class="text-xs text-gray-400">Distancia Total</p>
                </div>
                <!-- Chests Opened -->
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-box-open text-yellow-400 text-2xl mb-2"></i>
                    <p class="text-2xl font-bold text-yellow-400" id="total-chests"
                       th:text="${#numbers.formatInteger(stats.serverTotals.totalChestsOpened, 1, 'COMMA')}">0</p>
                    <p class="text-xs text-gray-400">Cofres Abiertos</p>
                </div>
                <!-- Total Blocks -->
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-cubes text-green-400 text-2xl mb-2"></i>
                    <p class="text-2xl font-bold text-green-400" id="total-blocks"
                       th:text="${#numbers.formatInteger(stats.serverTotals.totalBlocksMined, 1, 'COMMA')}">0</p>
                    <p class="text-xs text-gray-400">Bloques Minados</p>
                </div>
                <!-- Total Crafted -->
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-hammer text-orange-400 text-2xl mb-2"></i>
                    <p class="text-2xl font-bold text-orange-400" id="total-crafted"
                       th:text="${#numbers.formatInteger(stats.serverTotals.totalItemsCrafted, 1, 'COMMA')}">0</p>
                    <p class="text-xs text-gray-400">Items Crafteados</p>
                </div>
                <!-- Total Mobs -->
                <div class="bg-gray-800/50 rounded-lg p-4 text-center card-hover">
                    <i class="fas fa-skull text-pink-400 text-2xl mb-2"></i>
                    <p class="text-2xl font-bold text-pink-400" id="total-mobs"
                       th:text="${#numbers.formatInteger(stats.serverTotals.totalMobsKilled, 1, 'COMMA')}">0</p>
                    <p class="text-xs text-gray-400">Mobs Eliminados</p>
                </div>
            </div>
        </section>

        <!-- Player Detailed Stats -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-user-chart text-cyan-400 mr-3"></i>
                Estad√≠sticas por Jugador
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div th:each="player : ${stats.players}" class="bg-gray-800/50 rounded-lg p-6 card-hover">
                    <div class="flex items-center mb-4">
                        <img th:src="'https://mc-heads.net/avatar/' + ${player.name} + '/48'" 
                             class="w-12 h-12 rounded-lg mr-3" alt="Avatar">
                        <div>
                            <h3 class="font-bold text-lg" th:text="${player.name}">Player</h3>
                            <p class="text-sm text-gray-400" th:text="${player.summary.playTimeFormatted}">0h 0m</p>
                        </div>
                    </div>
                    
                    <!-- Combat Stats -->
                    <div class="mb-3" th:if="${player.detailedStats != null}">
                        <p class="text-xs text-gray-500 uppercase mb-2">‚öîÔ∏è Combate</p>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Da√±o infligido:</span>
                                <span class="text-red-400" th:text="${#numbers.formatInteger(player.detailedStats.damageDealt, 1, 'COMMA')}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Da√±o recibido:</span>
                                <span class="text-orange-400" th:text="${#numbers.formatInteger(player.detailedStats.damageTaken, 1, 'COMMA')}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Bloqueado:</span>
                                <span class="text-blue-400" th:text="${#numbers.formatInteger(player.detailedStats.damageBlocked, 1, 'COMMA')}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Muertes:</span>
                                <span class="text-pink-400" th:text="${player.summary.totalDeaths}">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Movement Stats -->
                    <div class="mb-3" th:if="${player.detailedStats != null}">
                        <p class="text-xs text-gray-500 uppercase mb-2">üö∂ Movimiento</p>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Caminando:</span>
                                <span class="text-green-400" th:text="${#numbers.formatDecimal(player.detailedStats.walkDistance / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Sprint:</span>
                                <span class="text-green-400" th:text="${#numbers.formatDecimal(player.detailedStats.sprintDistance / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Barco:</span>
                                <span class="text-blue-400" th:text="${#numbers.formatDecimal(player.detailedStats.boatDistance / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Caballo:</span>
                                <span class="text-yellow-400" th:text="${#numbers.formatDecimal(player.detailedStats.horseDistance / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Nadando:</span>
                                <span class="text-cyan-400" th:text="${#numbers.formatDecimal(player.detailedStats.swimDistance / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Volando:</span>
                                <span class="text-purple-400" th:text="${#numbers.formatDecimal(player.detailedStats.flyDistance / 100000.0, 1, 'COMMA', 1, 'POINT')} + ' km'">0 km</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interaction Stats -->
                    <div th:if="${player.detailedStats != null}">
                        <p class="text-xs text-gray-500 uppercase mb-2">üéÆ Interacciones</p>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Cofres:</span>
                                <span class="text-yellow-400" th:text="${player.detailedStats.chestsOpened}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Crafteos:</span>
                                <span class="text-orange-400" th:text="${player.detailedStats.craftingTableUses}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Hornos:</span>
                                <span class="text-red-400" th:text="${player.detailedStats.furnaceUses}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Dormido:</span>
                                <span class="text-purple-400" th:text="${player.detailedStats.timesSlept}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Comercios:</span>
                                <span class="text-emerald-400" th:text="${player.detailedStats.villagersTraded}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Pesca:</span>
                                <span class="text-blue-400" th:text="${player.detailedStats.fishCaught}">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Live Events Feed -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-rss text-red-400 mr-3 live-indicator"></i>
                Eventos en Vivo
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Recent Events -->
                <div class="bg-gray-800/50 rounded-lg p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-bolt text-yellow-400 mr-2"></i>
                        Actividad Reciente
                    </h3>
                    <div id="events-feed" class="space-y-2 max-h-64 overflow-y-auto">
                        <p class="text-gray-500 text-sm">Esperando eventos...</p>
                    </div>
                </div>
                
                <!-- Chat -->
                <div class="bg-gray-800/50 rounded-lg p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-comments text-blue-400 mr-2"></i>
                        Chat del Servidor
                    </h3>
                    <div id="chat-feed" class="space-y-2 max-h-64 overflow-y-auto">
                        <p class="text-gray-500 text-sm">Cargando mensajes...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- All Players -->
        <section>
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-users text-green-400 mr-3"></i>
                Todos los Jugadores
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <a th:each="player : ${stats.players}" 
                   th:href="@{/player/{uuid}(uuid=${player.uuid})}"
                   class="bg-gray-800/50 rounded-lg p-4 card-hover flex items-center space-x-4 hover:bg-gray-700/50 transition-colors">
                    <img th:src="'https://mc-heads.net/avatar/' + ${player.uuid} + '/64'" 
                         alt="Player Head" class="w-12 h-12 rounded">
                    <div class="flex-1">
                        <h3 class="font-bold" th:text="${player.name}">Player</h3>
                        <p class="text-sm text-gray-400">
                            <i class="fas fa-clock mr-1"></i>
                            <span th:text="${player.summary.playTimeFormatted}">0h</span>
                            <span class="mx-2">‚Ä¢</span>
                            <i class="fas fa-cubes mr-1"></i>
                            <span th:text="${#numbers.formatInteger(player.summary.totalBlocksMined, 1, 'COMMA')}">0</span> bloques
                        </p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-500"></i>
                </a>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>
                <i class="fas fa-code mr-2"></i>
                Minecraft Stats Web - Powered by Spring Boot & Kotlin
                <span class="mx-2">|</span>
                <i class="fas fa-plug mr-1"></i>
                <span id="ws-status">WebSocket: Desconectado</span>
            </p>
        </footer>
    </div>

    <!-- WebSocket JavaScript -->
    <script>
        let stompClient = null;
        
        function connect() {
            const socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            stompClient.debug = null;
            
            stompClient.connect({}, function(frame) {
                updateConnectionStatus(true);
                
                // Subscribe to server time (every 5 seconds)
                stompClient.subscribe('/topic/time', function(message) {
                    const update = JSON.parse(message.body);
                    updateServerTime(update.serverTime);
                });
                
                // Subscribe to server status
                stompClient.subscribe('/topic/status', function(message) {
                    const update = JSON.parse(message.body);
                    updateServerStatus(update.data);
                });
                
                // Subscribe to events
                stompClient.subscribe('/topic/events', function(message) {
                    const update = JSON.parse(message.body);
                    addEvent(update.data, update.serverTime);
                });
                
                // Subscribe to player times (for real-time counters)
                stompClient.subscribe('/topic/player-times', function(message) {
                    const update = JSON.parse(message.body);
                    updatePlayerTimes(update.data);
                });
                
                // Subscribe to stats updates
                stompClient.subscribe('/topic/stats', function(message) {
                    const update = JSON.parse(message.body);
                    updateStats(update.data);
                });
                
                loadInitialData();
                
            }, function(error) {
                updateConnectionStatus(false);
                setTimeout(connect, 5000);
            });
        }
        
        function updateServerTime(serverTime) {
            document.getElementById('server-time').textContent = serverTime.time;
            document.getElementById('server-date').textContent = `${serverTime.dayOfWeek}, ${serverTime.date}`;
            document.getElementById('last-update').textContent = serverTime.time;
        }
        
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connection-status');
            const wsStatus = document.getElementById('ws-status');
            if (connected) {
                statusEl.innerHTML = '<span class="w-3 h-3 bg-green-500 rounded-full mr-2 live-indicator"></span>En vivo';
                wsStatus.textContent = 'WebSocket: Conectado';
            } else {
                statusEl.innerHTML = '<span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>Desconectado';
                wsStatus.textContent = 'WebSocket: Desconectado';
            }
        }
        
        function updateServerStatus(status) {
            document.getElementById('player-count').textContent = status.playerCount;
            document.getElementById('max-players').textContent = status.maxPlayers;
            
            const playersList = document.getElementById('online-players-list');
            playersList.innerHTML = status.onlinePlayers.map(p => 
                `<span class="bg-green-600/30 text-green-300 px-3 py-1 rounded-full text-sm">
                    <i class="fas fa-circle text-green-400 text-xs mr-1"></i>${p.name}
                </span>`
            ).join('');
            
            if (status.lastUpdatedFormatted) {
                document.getElementById('last-update').textContent = status.lastUpdatedFormatted;
            }
        }
        
        function updatePlayerTimes(players) {
            players.forEach(p => {
                const el = document.getElementById(`player-time-${p.uuid}`);
                if (el) {
                    el.textContent = p.playTimeFormatted;
                    if (p.isOnline) {
                        el.classList.add('text-green-400');
                    }
                }
            });
        }
        
        function updateStats(data) {
            if (data.serverTotals) {
                const t = data.serverTotals;
                updateStatValue('total-blocks', t.totalBlocksMined);
                updateStatValue('total-crafted', t.totalItemsCrafted);
                updateStatValue('total-mobs', t.totalMobsKilled);
                updateStatValue('total-deaths', t.totalDeaths);
                updateStatValue('total-damage', t.totalDamageDealt);
            }
        }
        
        function updateStatValue(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value.toLocaleString();
        }
        
        function addEvent(event, serverTime) {
            const feed = document.getElementById('events-feed');
            const firstChild = feed.firstElementChild;
            if (firstChild && firstChild.textContent.includes('Esperando')) {
                feed.innerHTML = '';
            }
            
            let icon, color;
            switch(event.type) {
                case 'JOIN': icon = 'sign-in-alt'; color = 'green'; break;
                case 'LEAVE': icon = 'sign-out-alt'; color = 'red'; break;
                case 'DEATH': icon = 'skull'; color = 'pink'; break;
                case 'ADVANCEMENT': icon = 'trophy'; color = 'yellow'; break;
                case 'CHAT': icon = 'comment'; color = 'blue'; break;
                default: icon = 'info-circle'; color = 'gray';
            }
            
            const dateTime = event.fullDateTime || event.timestamp;
            const eventHtml = `
                <div class="flex items-start space-x-2 py-1 event-enter border-b border-gray-700/50 last:border-0">
                    <span class="text-${color}-400 w-5"><i class="fas fa-${icon}"></i></span>
                    <span class="text-gray-500 text-xs whitespace-nowrap">${dateTime}</span>
                    <span class="text-sm flex-1">${event.message}</span>
                </div>
            `;
            
            feed.insertAdjacentHTML('afterbegin', eventHtml);
            
            // Keep only last 20 events
            while (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
        }
        
        function addChatMessage(event) {
            const feed = document.getElementById('chat-feed');
            const firstChild = feed.firstElementChild;
            if (firstChild && firstChild.textContent.includes('Cargando')) {
                feed.innerHTML = '';
            }
            
            const dateTime = event.fullDateTime || event.timestamp;
            const chatHtml = `
                <div class="py-1 event-enter border-b border-gray-700/50 last:border-0">
                    <span class="text-gray-500 text-xs">${dateTime}</span>
                    <span class="text-green-400 font-bold">&lt;${event.playerName}&gt;</span>
                    <span class="text-sm">${event.message}</span>
                </div>
            `;
            
            feed.insertAdjacentHTML('afterbegin', chatHtml);
            
            while (feed.children.length > 30) {
                feed.removeChild(feed.lastChild);
            }
        }
        
        async function loadInitialData() {
            try {
                // Load server status
                const statusRes = await fetch('/api/status');
                const status = await statusRes.json();
                updateServerStatus(status);
                
                // Load recent events
                const eventsRes = await fetch('/api/events?limit=20');
                const events = await eventsRes.json();
                events.reverse().forEach(e => addEvent(e, null));
                
                // Load recent chat
                const chatRes = await fetch('/api/chat?limit=20');
                const chat = await chatRes.json();
                chat.reverse().forEach(addChatMessage);
                
            } catch (e) {
                console.error('Error loading initial data:', e);
            }
        }
        
        // Connect on page load
        connect();
    </script>
</body>
</html>
